[general]
static=yes
writeprotect=no
clearglobalvars=no

[globals]
FEATURES=
DIALOPTIONS=
RINGTIME=20
FOLLOWMEOPTIONS=a
PAGING_HEADER=Intercom
FOLLOWME_6060=0
trunk_1=SIP/trunk_1
CID_trunk_1=1234

#include "extensions_order_receiver.conf"

[macro-stdexten]
exten=s,1,Set(__DYNAMIC_FEATURES=${FEATURES})
exten=s,2,Set(ORIG_ARG1=${ARG1})
exten=s,3,GotoIf($["${FOLLOWME_${ARG1}}" = "1"]?6:4)
exten=s,4,Dial(${ARG2},${RINGTIME},${DIALOPTIONS})
exten=s,5,Goto(s-${DIALSTATUS},1)
exten=s,6,Macro(stdexten-followme,${ARG1},${ARG2})
exten=s-NOANSWER,1,Voicemail(${ORIG_ARG1},u)
exten=s-NOANSWER,2,Goto(default,s,1)
exten=s-BUSY,1,Voicemail(${ORIG_ARG1},b)
exten=s-BUSY,2,Goto(default,s,1)
exten=_s-.,1,Goto(s-NOANSWER,1)
exten=a,1,VoicemailMain(${ORIG_ARG1})

[macro-stdexten-followme]
exten=s,1,Answer
exten=s,2,Set(ORIG_ARG1=${ARG1})
exten=s,3,Dial(${ARG2},${RINGTIME},${DIALOPTIONS})
exten=s,4,Set(__FMCIDNUM=${CALLERID(num)})
exten=s,5,Set(__FMCIDNAME=${CALLERID(name)})
exten=s,6,Followme(${ORIG_ARG1},${FOLLOWMEOPTIONS})
exten=s,7,Voicemail(${ORIG_ARG1},u)
exten=s-NOANSWER,1,Voicemail(${ORIG_ARG1},u)
exten=s-BUSY,1,Voicemail(${ORIG_ARG1},b)
exten=s-BUSY,2,Goto(default,s,1)
exten=_s-.,1,Goto(s-NOANSWER,1)
exten=a,1,VoicemailMain(${ORIG_ARG1})

[macro-pagingintercom]
exten=s,1,SIPAddHeader(Alert-Info: ${PAGING_HEADER})
exten=s,2,Page(${ARG1},${ARG2})
exten=s,3,Hangup

[conferences]
exten=6300,1,MeetMe(${EXTEN},)

[queues2]
exten=1000,1,agentlogin()

[voicemenus]
exten=7000,1,Goto(voicemenu-custom-1,s,1)

[directory]
exten=1000,1,Directory(default,default,)

[pagegroups]
exten=6400,1,Macro(pagingintercom,SIP/6060,)

[asterisk_guitools]
exten=executecommand,1,System(${command})
exten=executecommand,n,Hangup()
exten=record_vmenu,1,Answer
exten=record_vmenu,n,Playback(vm-intro)
exten=record_vmenu,n,Record(${var1},0,500,k)
exten=record_vmenu,n,Playback(vm-saved)
exten=record_vmenu,n,Playback(vm-goodbye)
exten=record_vmenu,n,Hangup
exten=play_file,1,Answer
exten=play_file,n,Playback(${var1})
exten=play_file,n,Hangup

[queue-member-manager]
exten=handle_member,1,Verbose(2, Looping through queues to log in or out queue members)
exten=handle_member,n,Set(thisActiveMember=${CHANNEL(channeltype)}/${CHANNEL(peername)})
exten=handle_member,n,Set(queue_field=2)
exten=handle_member,n,Set(thisQueueXtn=${CUT(QUEUES,\,,${queue_field})})
exten=handle_member,n,While($[${EXISTS(${thisQueueXtn})}])
exten=handle_member,n,Macro(member-loginlogout)
exten=handle_member,n,Set(queue_field=$[${queue_field} + 1])
exten=handle_member,n,Set(thisQueueXtn=${CUT(QUEUES,\,,${queue_field})})
exten=handle_member,n,EndWhile()

[macro-member-loginlogout]
exten=s,1,Verbose(2, Logging queue member in or out of the request queue)
exten=s,n,Set(thisQueue=${thisQueueXtn})
exten=s,n,Set(queueMembers=${QUEUE_MEMBER_LIST(${thisQueue})})
exten=s,n,Set(field=1)
exten=s,n,Set(logged_in=0)
exten=s,n,Set(thisQueueMember=${CUT(queueMembers,\,,${field})})
exten=s,n,While($[${EXISTS(${thisQueueMember})}])
exten=s,n,GotoIf($["${thisQueueMember}" != "${thisActiveMember}"]?check_next)
exten=s,n,Set(logged_in=1)
exten=s,n,ExitWhile()
exten=s,n(check_next),Set(field=$[${field} + 1])
exten=s,n,Set(thisQueueMember=${CUT(queueMembers,\,,${field})})
exten=s,n,EndWhile()
exten=s,n,MacroIf($[${logged_in} = 0]?q_login:q_logout)

[macro-q_login]
exten=s,1,Verbose(2, Logging ${thisActiveMember} into the ${thisQueue} queue)
exten=s,n,AddQueueMember(${thisQueue},${thisActiveMember})
exten=s,n,Playback(silence/1)
exten=s,n,ExecIf($["${AQMSTATUS}" = "ADDED"]?Playback(agent-loginok):Playback(an-error-has-occurred))

[macro-q_logout]
exten=s,1,Verbose(2, Logged ${thisActiveMember} out of ${thisQueue} queue)
exten=s,n,RemoveQueueMember(${thisQueue},${thisActiveMember})
exten=s,n,Playback(silence/1)
exten=s,n,ExecIf($["${RQMSTATUS}" = "REMOVED"]?Playback(agent-loggedoff):Playback(an-error-has-occurred))

[CallingRule_1]
exten=_2XXXXXX,1,Macro(trunkdial-failover-0.3,${trunk_1}/${EXTEN:0},,trunk_1,)

[voicemenu-custom-1]
include=default
exten=s,1,NoOp(1)
exten=s,2,AGI(dfgdfg)

[CallingRule_local]
exten=6060,1,Goto(default,6060,1)

[DLPN_DialPlan1]
include=CallingRule_local
include=default
include=parkedcalls
include=conferences
include=ringgroups
include=voicemenus
include=queues
include=voicemailgroups
include=directory
include=pagegroups
include=page_an_extension

[DID_trunk_1]
include=DID_trunk_1_default

[trunk-Vasya]
include=international_calls
exten=s,1,Dial(SIP/gate)

[macro-local-callingrule-cid-0.1]
exten=s,1,Set(CALLERID(all)=${IF($[${LEN(${ARG4})} > 2]?${ARG4}:)})
exten=s,n,Goto(${ARG1},${ARG2},${ARG3})

[macro-trunkdial-failover-0.3]
exten=s,1,GotoIf($[${LEN(${FMCIDNUM})} > 6]?1-fmsetcid,1)
exten=s,n,GotoIf($[${LEN(${GLOBAL_OUTBOUNDCIDNAME})} > 1]?1-setgbobname,1)
exten=s,n,Set(CALLERID(num)=${IF($[${LEN(${CID_${CALLERID(num)}})} > 2]?${CID_${CALLERID(num)}}:)})
exten=s,n,Set(CALLERID(all)=${IF($[${LEN(${ARG5})} > 2]?${ARG5}:)})
exten=s,n,GotoIf($[${LEN(${CALLERID(num)})} > 6]?1-dial,1)
exten=s,n,Set(CALLERID(all)=${IF($[${LEN(${CID_${ARG3}})} > 6]?${CID_${ARG3}}:${GLOBAL_OUTBOUNDCID})})
exten=s,n,Set(CALLERID(all)=${IF($[${LEN(${ARG5})} > 2]?${ARG5}:)})
exten=s,n,Goto(1-dial,1)
exten=1-setgbobname,1,Set(CALLERID(name)=${GLOBAL_OUTBOUNDCIDNAME})
exten=1-setgbobname,n,Goto(s,3)
exten=1-fmsetcid,1,Set(CALLERID(num)=${FMCIDNUM})
exten=1-fmsetcid,n,Set(CALLERID(name)=${FMCIDNAME})
exten=1-fmsetcid,n,Goto(s,4)
exten=1-dial,1,Dial(${ARG1})
exten=1-dial,n,Gotoif(${LEN(${ARG2})} > 0 ?1-${DIALSTATUS},1:1-out,1)
exten=1-CHANUNAVAIL,1,Dial(${ARG2})
exten=1-CHANUNAVAIL,n,Hangup()
exten=1-CONGESTION,1,Dial(${ARG2})
exten=1-CONGESTION,n,Hangup()
exten=1-out,1,Hangup()

[trunk-undefined]
include=international_calls
exten=s,1,Dial(SIP/gate)


[outbound]
exten=1000,1,Verbose(${CALLERID(num)})
;exten=1000,n,Set(caller_num=88312345678)
exten=1000,n,Set(caller_num=89234567890)
;exten=1000,n,Set(caller_num=89135292926)
exten=1000,n,Set(CALLERID(num)=9135292926)
exten=1000,n,AGI(agi://localhost:3000,${caller_num})
exten=1000,n,Verbose(CONNECT=${CONNECT})
exten=1000,n,Verbose(NUMBER=${NUMBER})
exten=1000,n,Verbose(${RECOGNITION_RESULT})
exten=1000,n,Verbose(${RECOGNITION_TARGET})
exten=1000,n,Verbose(${LCR_RESULT})
exten=1000,n,Verbose(${LCR_STATUS})
exten=1000,n,Verbose(${LCR_SEQUENCE})
;exten=1000,n,GotoIf($[${RECOGNITION_RESULT}=SUCCESS]?:outbound,1000,8)
;exten=1000,n,Dial(${RECOGNITION_TARGET})
;exten=1000,n,GotoIf($[${REGION_CODE}=24]?outbound,qw,1:)
;exten=1000,n,GotoIf($[${REGION_CODE}=77]?outbound,qw2,1:outbound,qw3,1)
exten=6000,1,Dial(SIP/6000,,Ttr)
exten=6050,1,Dial(SIP/6050,,Ttr)
exten=6060,1,Dial(SIP/6060,,Ttr)

exten=700,1,Goto(queues,700,1)

exten=_X.,1,AGI(agi://localhost:3000)
exten=_X.,n,Verbose(${LCR_RESULT})
exten=_X.,n,Verbose(${LCR_STATUS})
exten=_X.,n,Verbose(${LCR_SEQUENCE})
exten=_X.,n,Gosub(hang,s,1(${CONTEXT}))
exten=_X.,n,Queue(1234,,,,10)
exten=_X.,n,Dial(SIP/${LCR_RESULT}/${EXTEN})
exten=_X.,n,Hangup()

exten=h,1,Verbose(${DIALSTATUS})
exten=h,n,Verbose(${QUEUESTATUS})
exten=h,n,Verbose(${CDR(dstchannel)})



exten=1005,1,Set(CALLERID(num)=89135292926)
exten=1005,n,AGI(agi://localhost:3010)


[outbound1]
exten=>_X.,1,Dial(Local/${EXTEN}@outbound,,U(pretech,answer1,${ORIGINATE_ACTIONID}))

[outbound2]
exten=>_X.,1,Dial(Local/${EXTEN}@outbound,,U(pretech,answer2,${ORIGINATE_ACTIONID}))

[pretech]
exten=s,1,NoOp(pretech) 
exten=s,n,Verbose(${CHANNEL(name)})
exten=s,n,UserEvent(${ARG1},actionid:${ARG2}) 
exten=s,n,Return()

[queues2]
exten=700,1,Queue(1234,,,,10)
exten=h,1,Verbose(${CDR(dstchannel)})
exten=h,n,Verbose(hello from queue)


[hang]
exten=s,1,Verbose(1,${CONTEXT})
exten=s,n,Verbose(${ARG1})
exten=s,n,Return()


